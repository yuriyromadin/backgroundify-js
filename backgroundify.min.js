/*!
 * jQuery plugin for create stunning image backgrounds
 * Original author: @yuriyromadin
 * Licensed under the MIT license
 * Version: 1.1
 */
!function(t,e,i,n){function r(e,i){this.element=e,this.options=t.extend({},d,i),this._defaults=d,this._name=a,this.init()}var a="backgroundify",o='<svg><defs><filter id="{0}"><feGaussianBlur in="SourceGraphic" stdDeviation="{2}"/><feComponentTransfer><feFuncA type="discrete" tableValues="1 1"/></feComponentTransfer><feColorMatrix type="saturate" values="{1}"/></filter></defs></svg>',s='<div class="backgroundify-wrap"><svg class="backgroundify-svg"><image preserveAspectRatio="none" xlink:href="{0}" width="100%" height="100%" filter="url(#{1})" /></svg></div>',u="backroundify_blur_{0}",h="<style>.backgroundify-wrap{height:100%;position:absolute;top:0;left:0;right:0;bottom:0;width:100%;z-index:0;}.backgroundify-svg{height:100%!important;vertical-align:top!important;width:100%!important;}</style>",d={type:"blur",radius:10,border:null,saturation:.5},l=function(t){return"#"+t},p=function(t,e,i){return t+","+e+","+i},c=function(t){var e=t.split(","),i=e[0],n=e[1],r=e[2];return l(f(i)+f(n)+f(r))},f=function(t){var e=parseInt(t).toString(16);return 1==e.length?"0"+e:e},g=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return e.replace(/{(\d+)}/g,function(e,i){return"undefined"!=typeof t[i]?t[i]:e})},v=function(e){return t(l(e)).length?!0:!1};r.prototype.extractDominantPixel=function(e,n){var r=i.createElement("canvas"),a=r.getContext("2d"),o=new Image,s=t.Deferred(),u=function(t,e){for(var i={},n=0,r="255,255,255",a=0;a<t.data.length;a+=4){var o=t.data[a],s=t.data[a+1],u=t.data[a+2],h=p(o,s,u),d=i[h]||0;if(e){var l=a/4%t.width,c=Math.floor(a/4/t.width),f=t.width*e,g=t.width-f,v=t.height*e,y=t.height-v;if(c>v&&y>c&&l>f&&g>l)continue}d>n&&(n=d,r=h),i[h]=++d}return r};return o.onload=function(){r.width=o.width,r.height=o.height,a.drawImage(o,0,0,o.width,o.height,0,0,o.width,o.height);var t=a.getImageData(0,0,o.width,o.height),e=c(u(t,n));s.resolve(e),r=null},o.crossOrigin="Anonymous",o.src=e,s},r.prototype.applyBlur=function(e,i){var n=g(u,this.options.radius),r=g(s,i,n),a=g(o,n,this.options.saturation,this.options.radius),h=g(u,"filter_wrap");v(h)||($filterWrap=t("<div>",{id:h}).appendTo("body")),v(n)||$filterWrap.append(a),e.append(r)},r.prototype.init=function(){var e=t(this.element),i=e.parent(),n=this.element.src;switch(this.options.type){case"blur":this.applyBlur(i,n);break;case"dominant":this.extractDominantPixel(n,this.options.border).done(function(t){i.css("background-color",t)})}},t.fn[a]=function(e){return this.each(function(){t.data(this,"plugin_"+a)||t.data(this,"plugin_"+a,new r(this,e))})},t(h).appendTo("head")}(jQuery,window,document);
